<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAPE KEEPER - Step 1: ë°œì£¼ ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background-color: #f1f5f9; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { border: 1px solid #ccc; padding: 8px; border-radius: 5px; width: 100%; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background: #f8fafc; color: #64748b; padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0; }
        td { padding: 10px; border-bottom: 1px solid #e2e8f0; vertical-align: middle; }
        .progress-bar { height: 10px; background: #e2e8f0; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .progress-fill { height: 100%; background: #3b82f6; transition: width 0.3s; }
    </style>
</head>
<body class="max-w-5xl mx-auto">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-slate-800">TAPE KEEPER <span class="text-sm font-normal text-slate-500">(1ë‹¨ê³„: ë°œì£¼ ê´€ë¦¬)</span></h1>
        <button onclick="resetData()" class="text-xs text-red-500 underline">ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>

    <div class="card">
        <h2 class="text-lg font-bold mb-4">ğŸ“ ìƒˆë¡œìš´ ë°œì£¼ ë“±ë¡</h2>
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
            <div>
                <label class="block text-xs text-gray-500 mb-1">ë‚©ê¸°ì¼</label>
                <input type="date" id="inputDate">
            </div>
            <div class="md:col-span-2">
                <label class="block text-xs text-gray-500 mb-1">ë°œì£¼ëª…</label>
                <input type="text" id="inputTitle" placeholder="ì˜ˆ: 7125Y 2000ê°œ ë‚©í’ˆ">
            </div>
            <div>
                <label class="block text-xs text-gray-500 mb-1">ëª©í‘œ ìˆ˜ëŸ‰(EA)</label>
                <input type="number" id="inputGoal" placeholder="0">
            </div>
            <div>
                <label class="block text-xs text-gray-500 mb-1">ë¹„ê³ </label>
                <input type="text" id="inputMemo" placeholder="ê±°ë˜ì²˜/íŠ¹ì´ì‚¬í•­">
            </div>
        </div>
        <button onclick="addOrder()" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition">
            + ë°œì£¼ ì¶”ê°€í•˜ê¸°
        </button>
    </div>

    <div class="card">
        <h2 class="text-lg font-bold mb-4">ğŸ“‹ ë°œì£¼ í˜„í™© (ë‚ ì§œìˆœ ì •ë ¬)</h2>
        <div class="overflow-x-auto">
            <table>
                <thead>
                    <tr>
                        <th style="width: 130px;">ë‚ ì§œ (ìˆ˜ì •ê°€ëŠ¥)</th>
                        <th>ë°œì£¼ëª… / ë¹„ê³ </th>
                        <th style="width: 100px;">ëª©í‘œìˆ˜ëŸ‰</th>
                        <th style="width: 150px;">ì§„í–‰ìƒí™©</th>
                        <th style="width: 80px;">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="orderListBody">
                    </tbody>
            </table>
        </div>
    </div>

<script>
    // --- 1. ë°ì´í„° ê´€ë¦¬ ---
    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´
    let orders = JSON.parse(localStorage.getItem('TK_STEP1_ORDERS')) || [];

    // ì €ì¥ í•¨ìˆ˜
    function saveOrders() {
        localStorage.setItem('TK_STEP1_ORDERS', JSON.stringify(orders));
        render(); // ì €ì¥ í›„ í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    }

    // --- 2. ê¸°ëŠ¥ êµ¬í˜„ ---

    // (1) ë°œì£¼ ì¶”ê°€
    function addOrder() {
        const date = document.getElementById('inputDate').value;
        const title = document.getElementById('inputTitle').value;
        const goal = parseInt(document.getElementById('inputGoal').value);
        const memo = document.getElementById('inputMemo').value;

        if (!date || !title || !goal) {
            alert("ë‚ ì§œ, ë°œì£¼ëª…, ëª©í‘œìˆ˜ëŸ‰ì€ í•„ìˆ˜ì…ë‹ˆë‹¤!");
            return;
        }

        const newOrder = {
            id: Date.now(), // ê³ ìœ  ID
            date: date,
            title: title,
            goal: goal,
            done: 0, // í˜„ì¬ ì‘ì—…ëŸ‰ (ë‚˜ì¤‘ì— ì‘ì—… ê¸°ëŠ¥ ë§Œë“¤ë©´ ì˜¬ë¼ê°)
            memo: memo
        };

        orders.push(newOrder);
        
        // ì…ë ¥ì°½ ë¹„ìš°ê¸°
        document.getElementById('inputTitle').value = '';
        document.getElementById('inputGoal').value = '';
        document.getElementById('inputMemo').value = '';
        
        saveOrders();
    }

    // (2) ë°œì£¼ ì‚­ì œ
    function deleteOrder(id) {
        if(confirm('ì •ë§ ì´ ë°œì£¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            orders = orders.filter(order => order.id !== id);
            saveOrders();
        }
    }

    // (3) ë°ì´í„° ìˆ˜ì • (ë‚ ì§œ, ëª©í‘œìˆ˜ëŸ‰ ë“± ë³€ê²½ ì‹œ ë°”ë¡œ ì €ì¥)
    function updateOrder(id, field, value) {
        const order = orders.find(o => o.id === id);
        if (order) {
            if (field === 'goal') value = parseInt(value); // ìˆ˜ëŸ‰ì€ ìˆ«ìë¡œ ë³€í™˜
            order[field] = value;
            saveOrders();
        }
    }

    // (4) ë°ì´í„° ì´ˆê¸°í™”
    function resetData() {
        if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì§€ìš°ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?")) {
            orders = [];
            saveOrders();
        }
    }

    // --- 3. í™”ë©´ ê·¸ë¦¬ê¸° (Render) ---
    function render() {
        const tbody = document.getElementById('orderListBody');
        tbody.innerHTML = '';

        // ë‚ ì§œìˆœ ì •ë ¬ (ë¹ ë¥¸ ë‚ ì§œê°€ ìœ„ë¡œ)
        orders.sort((a, b) => new Date(a.date) - new Date(b.date));

        if (orders.length === 0) {
            tbody.innerHTML = `<tr><td colspan="5" class="text-center py-8 text-gray-400">ë“±ë¡ëœ ë°œì£¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            return;
        }

        orders.forEach(order => {
            // í¼ì„¼íŠ¸ ê³„ì‚°
            let percent = 0;
            if (order.goal > 0) {
                percent = Math.round((order.done / order.goal) * 100);
            }
            // 100% ë„˜ìœ¼ë©´ 100ìœ¼ë¡œ ê³ ì • (ê·¸ë˜í”½ìš©)
            let barWidth = percent > 100 ? 100 : percent; 
            
            // ìƒ‰ìƒ: ì™„ë£Œë˜ë©´ ì´ˆë¡, ì•„ë‹ˆë©´ íŒŒë‘
            let barColor = percent >= 100 ? 'bg-green-500' : 'bg-blue-500';

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>
                    <input type="date" value="${order.date}" 
                           onchange="updateOrder(${order.id}, 'date', this.value)"
                           class="bg-transparent border-none focus:ring-0 cursor-pointer">
                </td>
                <td>
                    <div class="font-bold text-gray-800">${order.title}</div>
                    <div class="text-xs text-gray-500">${order.memo ? 'Note: ' + order.memo : ''}</div>
                </td>
                <td>
                    <input type="number" value="${order.goal}" 
                           onchange="updateOrder(${order.id}, 'goal', this.value)"
                           class="w-24 text-right bg-gray-50 border border-gray-200 focus:bg-white">
                </td>
                <td>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="font-bold text-gray-700">${order.done.toLocaleString()} / ${order.goal.toLocaleString()}</span>
                        <span class="text-blue-600 font-bold">${percent}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${barColor}" style="width: ${barWidth}%"></div>
                    </div>
                </td>
                <td>
                    <button onclick="deleteOrder(${order.id})" class="text-white bg-red-400 hover:bg-red-500 px-3 py-1 rounded text-xs">ì‚­ì œ</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    // ì´ˆê¸° ì‹¤í–‰
    // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
    document.getElementById('inputDate').valueAsDate = new Date();
    render();
</script>

</body>
</html>
