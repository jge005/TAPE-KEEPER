<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAPE KEEPER - 통합 공정 관리</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f3f4f6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 1.5rem; }
    </style>
</head>
<body class="p-4 md:p-8">
    <header class="max-w-7xl mx-auto mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg">
                <span class="text-white font-bold text-xl">TK</span>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-gray-800">TAPE KEEPER</h1>
                <p class="text-sm text-gray-500">자재·재공·발주·세트(LOT)·작업일지 자동화</p>
            </div>
        </div>
        <div class="flex gap-2">
            <span id="saveStatus" class="px-3 py-1 bg-gray-100 text-gray-600 text-xs rounded-full flex items-center">저장: Local</span>
            <button onclick="exportData()" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-50">CSV 내보내기</button>
            <button onclick="window.print()" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-50">오늘 작업일지 인쇄</button>
            <button onclick="resetAllData()" class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600">초기화(주의)</button>
        </div>
    </header>

    <nav class="max-w-7xl mx-auto mb-8 overflow-x-auto">
        <div class="flex gap-2 min-w-max pb-2">
            <button onclick="showTab('dashboard')" class="tab-btn active px-6 py-2 bg-white text-gray-600 rounded-full text-sm font-semibold shadow-sm hover:bg-gray-100 transition-all">대시보드</button>
            <button onclick="showTab('material')" class="tab-btn px-6 py-2 bg-white text-gray-600 rounded-full text-sm font-semibold shadow-sm hover:bg-gray-100 transition-all">자재(원단/실무)</button>
            <button onclick="showTab('wip')" class="tab-btn px-6 py-2 bg-white text-gray-600 rounded-full text-sm font-semibold shadow-sm hover:bg-gray-100 transition-all">제품·재공(WIP)·포장실</button>
            <button onclick="showTab('order')" class="tab-btn px-6 py-2 bg-blue-100 text-blue-600 rounded-full text-sm font-semibold shadow-sm hover:bg-blue-200 transition-all">발주·계획(세트/LOT)</button>
            <button onclick="showTab('execution')" class="tab-btn px-6 py-2 bg-white text-gray-600 rounded-full text-sm font-semibold shadow-sm hover:bg-gray-100 transition-all">작업 실행·일지</button>
            <button onclick="showTab('logs')" class="tab-btn px-6 py-2 bg-white text-gray-600 rounded-full text-sm font-semibold shadow-sm hover:bg-gray-100 transition-all">작업일지(전체)</button>
            <button onclick="showTab('settings')" class="tab-btn px-6 py-2 bg-white text-gray-600 rounded-full text-sm font-semibold shadow-sm hover:bg-gray-100 transition-all">매핑/설정</button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto">
        <section id="order" class="tab-content active grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="card">
                <h2 class="text-lg font-bold mb-4 text-gray-800">발주 등록 (Order Master)</h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">발주명</label>
                        <input type="text" id="orderName" placeholder="예: 1/24 납기 7125Y" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">목표 수량(EA)</label>
                        <input type="number" id="orderTarget" placeholder="2,000" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">납기일</label>
                        <input type="date" id="orderDueDate" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">메모(선택)</label>
                        <input type="text" id="orderMemo" placeholder="특이사항" class="w-full p-2 border rounded-lg">
                    </div>
                </div>
                <button onclick="addOrder()" class="w-full py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">발주 생성</button>
                
                <div class="mt-6 overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-50 text-gray-500 border-b">
                            <tr>
                                <th class="p-2">납기</th>
                                <th class="p-2">발주명</th>
                                <th class="p-2">목표합</th>
                                <th class="p-2">완료</th>
                                <th class="p-2">달성률</th>
                                <th class="p-2">삭제</th>
                            </tr>
                        </thead>
                        <tbody id="orderList"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2 class="text-lg font-bold mb-2 text-gray-800">세트/LOT 계획 (Execution Plan)</h2>
                <p class="text-xs text-gray-500 mb-4">발주 하나를 여러 날짜에 나눠 작업 가능. 제품 선택 시 테이프 자동 로딩.</p>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">발주 선택</label>
                        <select id="lotOrderRef" class="w-full p-2 border rounded-lg"></select>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">발행 LOT</label>
                        <input type="text" id="lotNumber" placeholder="예: A-0120-1" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">작업 예정일</label>
                        <input type="date" id="lotDate" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">제품 선택</label>
                        <select id="lotProductSelect" onchange="autoMatchTape()" class="w-full p-2 border rounded-lg">
                            <option value="">(선택)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">수량(EA)</label>
                        <input type="number" id="lotQty" class="w-full p-2 border rounded-lg">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-xs text-gray-500 mb-1">자동 매칭(테이프/배열수)</label>
                    <input type="text" id="lotAutoMatchInfo" disabled class="w-full p-2 bg-gray-50 border rounded-lg text-sm text-blue-600 font-bold">
                </div>
                <button onclick="addLot()" class="w-full py-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700">세트 추가</button>
            </div>
        </section>
        
        </main>

    <script>
        // --- 마스터 데이터 (사용자님이 알려주신 규칙) ---
        let mappingRules = [
            { name: "6855시리즈", keyword: "6855", tape: "6855", size: "450x237", array: 8 },
            { name: "7125시리즈", keyword: "7125", tape: "6855", size: "450x237", array: 8 },
            { name: "6405시리즈", keyword: "6405", tape: "6405", size: "470x130", array: 2 },
            { name: "RR7000(김치좌)", keyword: "6907A", tape: "RR7000", size: "510x295", array: 2 },
            { name: "RR7000(기본우)", keyword: "6908C", tape: "RR7000", size: "510x295", array: 2 },
            { name: "5869시리즈", keyword: "5869", tape: "5869", size: "410x315", array: 4 },
            { name: "6491시리즈", keyword: "6491", tape: "6491", size: "450x120", array: 4 },
            { name: "6406전용", keyword: "24001W", tape: "6406", size: "470x130", array: 2 },
            { name: "4221전용", keyword: "4221A", tape: "4221", size: "195x385", array: 4 },
            { name: "7011전용", keyword: "7011A", tape: "7011", size: "550x315", array: 1 }
        ];

        let state = JSON.parse(localStorage.getItem('tapeKeeperState')) || {
            materials: [],
            products: [],
            orders: [],
            lots: [],
            logs: []
        };

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('bg-blue-100', 'text-blue-600'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('bg-blue-100', 'text-blue-600');
            renderAll();
        }

        // 발주 등록 함수 (수량 포함)
        function addOrder() {
            const name = document.getElementById('orderName').value;
            const target = parseInt(document.getElementById('orderTarget').value);
            const due = document.getElementById('orderDueDate').value;
            if(!name || !target) return alert('발주명과 목표 수량을 입력하세요!');

            state.orders.push({
                id: Date.now(),
                name,
                target,
                due,
                memo: document.getElementById('orderMemo').value,
                completed: 0
            });
            saveAndRender();
        }

        function autoMatchTape() {
            const productName = document.getElementById('lotProductSelect').value;
            const match = mappingRules.find(r => productName.includes(r.keyword));
            if(match) {
                document.getElementById('lotAutoMatchInfo').value = `테이프: ${match.tape} | 규격: ${match.size} | 배열수: ${match.array}`;
            } else {
                document.getElementById('lotAutoMatchInfo').value = "매칭 정보 없음 (수동 입력 필요)";
            }
        }

        function saveAndRender() {
            localStorage.setItem('tapeKeeperState', JSON.stringify(state));
            renderAll();
        }

        function renderAll() {
            const list = document.getElementById('orderList');
            list.innerHTML = state.orders.map(o => `
                <tr class="border-b">
                    <td class="p-2">${o.due}</td>
                    <td class="p-2 font-bold">${o.name}</td>
                    <td class="p-2">${o.target.toLocaleString()}</td>
                    <td class="p-2">${o.completed.toLocaleString()}</td>
                    <td class="p-2"><span class="text-xs px-2 py-1 bg-red-100 text-red-600 rounded">미달</span></td>
                    <td class="p-2"><button onclick="deleteOrder(${o.id})" class="text-red-400">삭제</button></td>
                </tr>
            `).join('');
            
            // 발주 선택 셀렉트박스 업데이트
            const select = document.getElementById('lotOrderRef');
            select.innerHTML = '<option value="">(선택)</option>' + state.orders.map(o => `<option value="${o.id}">${o.name}</option>`).join('');
        }

        // 초기 렌더링
        window.onload = renderAll;
    </script>
</body>
</html>
