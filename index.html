<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TAPE KEEPER - 핵심 공정 관리</title>
  <style>
    :root {
      --bg: #f8fafc; --card: #ffffff; --pri: #6d5efc; --ink: #1e293b;
      --line: #e2e8f0; --muted: #64748b; --shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    * { box-sizing: border-box; font-family: sans-serif; }
    body { margin: 0; background: var(--bg); color: var(--ink); }
    .wrap { max-width: 900px; margin: 0 auto; padding: 20px; }
    header { background: #fff; border-bottom: 1px solid var(--line); padding: 15px 0; margin-bottom: 20px; position: sticky; top: 0; z-index: 10; }
    .nav { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
    .tab-btn { padding: 10px 20px; border-radius: 20px; border: 1px solid var(--line); background: #fff; cursor: pointer; white-space: nowrap; font-size: 14px; }
    .tab-btn.active { background: var(--pri); color: #fff; border-color: var(--pri); font-weight: bold; }
    .card { background: var(--card); border-radius: 12px; padding: 20px; box-shadow: var(--shadow); border: 1px solid var(--line); margin-bottom: 20px; }
    h2 { font-size: 16px; margin: 0 0 15px 0; color: var(--pri); }
    .row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
    .field { flex: 1; min-width: 150px; display: flex; flex-direction: column; gap: 5px; }
    label { font-size: 12px; color: var(--muted); }
    input, select { padding: 10px; border: 1px solid var(--line); border-radius: 8px; outline: none; }
    button.main-btn { padding: 10px 20px; background: var(--pri); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 12px 8px; border-bottom: 1px solid var(--line); text-align: left; }
    th { color: var(--muted); font-weight: normal; }
    .right { text-align: right; }
    .hidden { display: none; }
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h1 style="margin:0; font-size:20px;">TAPE KEEPER</h1>
      <button onclick="resetData()" style="font-size:11px; color:red; border:none; background:none; cursor:pointer;">초기화</button>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="nav">
    <button class="tab-btn active" onclick="showTab('tab1')">1. 발주/재고 등록</button>
    <button class="tab-btn" onclick="showTab('tab2')">2. 테이프 작업</button>
    <button class="tab-btn" onclick="showTab('tab3')">3. 현황판</button>
  </div>

  <section id="tab1">
    <div class="card">
      <h2>발주 등록 (Order)</h2>
      <div class="row">
        <div class="field"><label>발주명</label><input id="ord_name" placeholder="예: 7125Y 2000개" /></div>
        <div class="field"><label>목표 수량</label><input id="ord_goal" type="number" /></div>
        <button class="main-btn" onclick="addOrder()">발주 생성</button>
      </div>
    </div>
    <div class="card">
      <h2>테이프 작업 전 재고 등록 (WIP)</h2>
      <div class="row">
        <div class="field"><label>제품명</label><input id="wip_name" placeholder="예: 7125Y" /></div>
        <div class="field"><label>현재 재고(EA)</label><input id="wip_qty" type="number" /></div>
        <button class="main-btn" onclick="addWip()">재고 등록</button>
      </div>
    </div>
    <div class="card">
      <h2>실무 테이프 기초 재고</h2>
      <div class="row">
        <div class="field"><label>테이프 번호</label><input id="t_name" placeholder="예: 6855" /></div>
        <div class="field"><label>보유 장수(Sheets)</label><input id="t_qty" type="number" /></div>
        <button class="main-btn" onclick="addTape()">테이프 입고</button>
      </div>
    </div>
  </section>

  <section id="tab2" class="hidden">
    <div class="card">
      <h2>테이프 작업 실행 (Execution)</h2>
      <div class="row">
        <div class="field"><label>작업할 발주</label><select id="ex_order_sel"></select></div>
        <div class="field"><label>대상 제품(WIP)</label><select id="ex_wip_sel"></select></div>
      </div>
      <div class="row">
        <div class="field"><label>작업 수량(EA)</label><input id="ex_qty" type="number" /></div>
        <div class="field"><label>사용할 테이프</label><select id="ex_tape_sel"></select></div>
        <div class="field"><label>배열수(장당)</label><input id="ex_arr" type="number" value="8" /></div>
      </div>
      <button class="main-btn" style="width:100%" onclick="doWork()">작업 완료 (재고 차감)</button>
    </div>
  </section>

  <section id="tab3" class="hidden">
    <div class="card">
      <h2>발주 달성 현황</h2>
      <table id="order_table"><thead><tr><th>발주명</th><th>목표</th><th>완료</th><th>달성률</th></tr></thead><tbody></tbody></table>
    </div>
    <div class="card">
      <h2>남은 테이프 현황</h2>
      <table id="tape_table"><thead><tr><th>테이프</th><th>남은 장수</th></tr></thead><tbody></tbody></table>
    </div>
    <div class="card">
      <h2>작업 전 제품(WIP) 현황</h2>
      <table id="wip_table"><thead><tr><th>제품명</th><th>남은 수량(EA)</th></tr></thead><tbody></tbody></table>
    </div>
  </section>
</div>

<script>
let state = JSON.parse(localStorage.getItem('TK_CORE')) || {
  orders: [], wip: {}, tapes: {}, logs: []
};

function save() {
  localStorage.setItem('TK_CORE', JSON.stringify(state));
  render();
}

function showTab(tabId) {
  document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
  document.getElementById(tabId).classList.remove('hidden');
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  render();
}

function addOrder() {
  const name = document.getElementById('ord_name').value;
  const goal = parseInt(document.getElementById('ord_goal').value);
  if(!name || !goal) return alert("발주명과 수량을 입력하세요.");
  state.orders.push({ name, goal, done: 0 });
  document.getElementById('ord_name').value = '';
  document.getElementById('ord_goal').value = '';
  save();
}

function addWip() {
  const name = document.getElementById('wip_name').value;
  const qty = parseInt(document.getElementById('wip_qty').value);
  if(!name || isNaN(qty)) return alert("정보를 확인하세요.");
  state.wip[name] = (state.wip[name] || 0) + qty;
  save();
}

function addTape() {
  const name = document.getElementById('t_name').value;
  const qty = parseInt(document.getElementById('t_qty').value);
  if(!name || isNaN(qty)) return alert("정보를 확인하세요.");
  state.tapes[name] = (state.tapes[name] || 0) + qty;
  save();
}

function doWork() {
  const ordIdx = document.getElementById('ex_order_sel').value;
  const wipName = document.getElementById('ex_wip_sel').value;
  const tapeName = document.getElementById('ex_tape_sel').value;
  const qty = parseInt(document.getElementById('ex_qty').value);
  const arr = parseInt(document.getElementById('ex_arr').value);

  if(ordIdx==="" || !wipName || !tapeName || !qty) return alert("모든 칸을 채워주세요.");
  
  const needSheets = Math.ceil(qty / arr);
  
  if(state.wip[wipName] < qty) return alert("WIP 재고가 부족합니다.");
  if(state.tapes[tapeName] < needSheets) return alert("테이프 재고가 부족합니다.");

  // 재고 차감 및 실적 더하기
  state.wip[wipName] -= qty;
  state.tapes[tapeName] -= needSheets;
  state.orders[ordIdx].done += qty;
  
  alert(`작업 완료! 테이프 ${needSheets}장이 차감되었습니다.`);
  save();
}

function render() {
  // 발주 선택박스
  const ordSel = document.getElementById('ex_order_sel');
  ordSel.innerHTML = state.orders.map((o, i) => `<option value="${i}">${o.name}</option>`).join('<option value="">(발주 선택)</option>');

  // WIP 선택박스
  const wipSel = document.getElementById('ex_wip_sel');
  wipSel.innerHTML = Object.keys(state.wip).map(k => `<option value="${k}">${k}</option>`).join('<option value="">(제품 선택)</option>');

  // 테이프 선택박스
  const tapeSel = document.getElementById('ex_tape_sel');
  tapeSel.innerHTML = Object.keys(state.tapes).map(k => `<option value="${k}">${k}</option>`).join('<option value="">(테이프 선택)</option>');

  // 현황판 표
  document.querySelector('#order_table tbody').innerHTML = state.orders.map(o => `
    <tr><td>${o.name}</td><td>${o.goal}</td><td>${o.done}</td><td>${((o.done/o.goal)*100).toFixed(1)}%</td></tr>
  `).join('');

  document.querySelector('#tape_table tbody').innerHTML = Object.keys(state.tapes).map(k => `
    <tr><td>${k}</td><td>${state.tapes[k]}장</td></tr>
  `).join('');

  document.querySelector('#wip_table tbody').innerHTML = Object.keys(state.wip).map(k => `
    <tr><td>${k}</td><td>${state.wip[k]}EA</td></tr>
  `).join('');
}

function resetData() {
  if(confirm("모든 데이터를 초기화할까요?")) {
    state = { orders: [], wip: {}, tapes: {}, logs: [] };
    save();
  }
}

window.onload = render;
</script>
</body>
</html>
