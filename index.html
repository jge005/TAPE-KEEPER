<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAPE KEEPER - Tape Stock Ver.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background-color: #f1f5f9; padding: 20px; }
        .tab-btn { padding: 10px 20px; font-weight: bold; color: #64748b; border-bottom: 2px solid transparent; cursor: pointer; }
        .tab-btn.active { color: #3b82f6; border-bottom: 2px solid #3b82f6; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select { border: 1px solid #ccc; padding: 8px; border-radius: 5px; width: 100%; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background: #f8fafc; color: #64748b; padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0; }
        td { padding: 10px; border-bottom: 1px solid #e2e8f0; vertical-align: middle; }
        .progress-bar { height: 10px; background: #e2e8f0; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .progress-fill { height: 100%; background: #3b82f6; transition: width 0.3s; }
        .hidden { display: none; }
        #loading { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); display:flex; justify-content:center; align-items:center; z-index:9999; }
    </style>
</head>
<body class="max-w-6xl mx-auto">

    <div id="loading"><div class="text-xl font-bold text-blue-600">ë°ì´í„° ë™ê¸°í™” ì¤‘...</div></div>

    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <div class="flex items-center gap-2">
            <h1 class="text-2xl font-bold text-slate-800">TAPE KEEPER</h1>
            <span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full font-bold">â— ì˜¨ë¼ì¸</span>
        </div>
        <div class="flex space-x-2 bg-white px-2 rounded-lg shadow-sm overflow-x-auto">
            <button id="btn-orderTab" class="tab-btn active whitespace-nowrap">1. ë°œì£¼ ê´€ë¦¬</button>
            <button id="btn-workTab" class="tab-btn whitespace-nowrap">2. ì„¸íŠ¸ ì‘ì—…</button>
            <button id="btn-tapeTab" class="tab-btn whitespace-nowrap text-indigo-600">3. í…Œì´í”„ ìì¬</button>
        </div>
    </div>

    <div id="orderTab">
        <div class="card">
            <h2 class="text-lg font-bold mb-4">ğŸ“ ë°œì£¼ ë“±ë¡</h2>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                <div><label class="text-xs text-gray-500">ë‚©ê¸°ì¼</label><input type="date" id="inputDate"></div>
                <div class="md:col-span-2"><label class="text-xs text-gray-500">ë°œì£¼ëª…</label><input type="text" id="inputTitle" placeholder="ì˜ˆ: 7125Y 2000ê°œ"></div>
                <div><label class="text-xs text-gray-500">ëª©í‘œ ìˆ˜ëŸ‰</label><input type="number" id="inputGoal" placeholder="0"></div>
                <div><label class="text-xs text-gray-500">ë¹„ê³ </label><input type="text" id="inputMemo" placeholder="íŠ¹ì´ì‚¬í•­"></div>
            </div>
            <button id="btnAddOrder" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg">ë°œì£¼ ì¶”ê°€</button>
        </div>

        <div class="card">
            <h2 class="text-lg font-bold mb-4">ğŸ“‹ ë°œì£¼ í˜„í™©</h2>
            <div class="overflow-x-auto">
                <table>
                    <thead><tr><th style="width:130px;">ë‚ ì§œ</th><th>ë°œì£¼ëª…</th><th style="width:100px;">ëª©í‘œ</th><th style="width:150px;">ì§„í–‰ë¥ </th><th style="width:60px;">ì‚­ì œ</th></tr></thead>
                    <tbody id="orderListBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="workTab" class="hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="card border-t-4 border-indigo-500">
                <h2 class="text-lg font-bold mb-4 text-indigo-900">ğŸ“¦ ì„¸íŠ¸(LOT) ë“±ë¡</h2>
                <div class="space-y-3">
                    <div><label class="text-xs text-gray-500">ì œí’ˆëª…</label><input type="text" id="wipName" placeholder="ì˜ˆ: 7125Y"></div>
                    <div><label class="text-xs text-gray-500">ì„¸íŠ¸ ì´ë¦„ (LOT)</label><input type="text" id="wipLot" placeholder="ì˜ˆ: A-1"></div>
                    <div><label class="text-xs text-gray-500">ìˆ˜ëŸ‰ (EA)</label><input type="number" id="wipQty" placeholder="0"></div>
                    <button id="btnAddWip" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded-lg">ì„¸íŠ¸ ì¶”ê°€</button>
                </div>
                <div class="mt-4">
                    <h3 class="text-sm font-bold text-gray-600 mb-2">ëŒ€ê¸° ëª©ë¡</h3>
                    <div id="wipList" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>
            </div>

            <div class="card border-t-4 border-green-500">
                <h2 class="text-lg font-bold mb-4 text-green-900">ğŸš€ ì‘ì—… ì‹¤í–‰</h2>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-gray-500 font-bold">1. ì‘ì—…í•  ì„¸íŠ¸ ì„ íƒ</label>
                        <select id="workProductSelect" class="bg-gray-50 border-2 border-green-200 p-2 rounded w-full"></select>
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 font-bold">2. ì‘ì—… ìˆ˜ëŸ‰ (EA)</label>
                        <input type="number" id="workAmount" placeholder="0" class="border-2 border-green-200 focus:border-green-500 p-2 rounded w-full">
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold text-gray-500">ì‚¬ìš©ë  í…Œì´í”„</span>
                            <span id="calcTapeName" class="text-sm font-bold text-blue-600">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-gray-500">ì˜ˆìƒ ì†Œëª¨ëŸ‰</span>
                            <span id="calcTapeAmount" class="text-sm font-bold text-red-600">0ì¥</span>
                        </div>
                        <div id="predictionBox" class="text-xs text-gray-500 mt-2 pt-2 border-t">ì„¸íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
                    </div>

                    <button id="btnDoWork" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg text-lg shadow-md">ì‘ì—… ì™„ë£Œ</button>
                    <div id="workResultMsg" class="p-3 bg-green-50 text-green-800 text-sm font-bold rounded text-center hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="tapeTab" class="hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="card lg:col-span-1 border-t-4 border-pink-500">
                <h2 class="text-lg font-bold mb-4 text-pink-900">ğŸ“¥ í…Œì´í”„ ì…ê³ </h2>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-gray-500">í…Œì´í”„ ì¢…ë¥˜</label>
                        <select id="tapeTypeInput" class="bg-white">
                            <option value="6855">6855 (450x237)</option>
                            <option value="6405">6405 (470x130)</option>
                            <option value="6406">6406 (470x130)</option>
                            <option value="RR7000">RR7000 (510x295)</option>
                            <option value="5869">5869 (410x315)</option>
                            <option value="6491">6491 (450x120)</option>
                            <option value="4195">4195 (470x237)</option>
                            <option value="4221">4221 (195x385)</option>
                            <option value="7011">7011 (550x315)</option>
                            <option value="6934">6934 (510x195)</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€ (ì§ì ‘ì…ë ¥)</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-gray-500">ì…ê³  ìˆ˜ëŸ‰ (ì¥/Sheet)</label>
                        <input type="number" id="tapeQtyInput" placeholder="0">
                    </div>
                    <button id="btnAddTape" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 rounded-lg">ì¬ê³  ì¶”ê°€</button>
                </div>
            </div>

            <div class="card lg:col-span-2">
                <h2 class="text-lg font-bold mb-4">ğŸ“Š í…Œì´í”„ ì¬ê³  í˜„í™©</h2>
                <div class="overflow-x-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>í…Œì´í”„ëª…</th>
                                <th>ê·œê²©</th>
                                <th class="text-right">í˜„ì¬ê³  (ì¥)</th>
                                <th class="text-center">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="tapeListBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, query, orderBy, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAkMFlhE-19SvNS6XeHqTAHM3UTHHLb9Ww",
        authDomain: "tapekeeper-8070e.firebaseapp.com",
        projectId: "tapekeeper-8070e",
        storageBucket: "tapekeeper-8070e.firebasestorage.app",
        messagingSenderId: "267507609999",
        appId: "1:267507609999:web:889761a8792b0fa1a6dbfa",
        measurementId: "G-B68XN789S1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- ë°ì´í„° ìƒíƒœ ---
    let orders = [];
    let wip = [];
    let tapes = {}; // { "6855": { qty: 100, size: "450x237" }, ... }

    // --- ë§¤í•‘ ê·œì¹™ (User Defined) ---
    const MAPPING = {
        "7125": { tape: "6855", arr: 8, size: "450x237" }, "6855": { tape: "6855", arr: 8, size: "450x237" },
        "6405": { tape: "6405", arr: 2, size: "470x130" }, "6907": { tape: "RR7000", arr: 2, size: "510x295" },
        "6908": { tape: "RR7000", arr: 2, size: "510x295" }, "5869": { tape: "5869", arr: 4, size: "410x315" },
        "6491": { tape: "6491", arr: 4, size: "450x120" }, "4195": { tape: "4195", arr: 4, size: "470x237" },
        "4221": { tape: "4221", arr: 4, size: "195x385" }, "7011": { tape: "7011", arr: 1, size: "550x315" },
        "6934": { tape: "6934", arr: 4, size: "510x195" }, "24001W": { tape: "6406", arr: 2, size: "470x130" },
        "2254D": { tape: "6491", arr: 4, size: "450x120" }
    };

    const loading = document.getElementById('loading');

    // --- Firebase ë¦¬ìŠ¤ë„ˆ ---
    
    // 1. Orders
    onSnapshot(query(collection(db, "orders")), (snap) => {
        orders = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        renderOrders();
        loading.style.display = 'none';
    });

    // 2. WIP
    onSnapshot(query(collection(db, "wip")), (snap) => {
        wip = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        renderWip();
    });

    // 3. Tapes (ìƒˆë¡œ ì¶”ê°€ë¨)
    onSnapshot(query(collection(db, "tapes")), (snap) => {
        tapes = {};
        snap.docs.forEach(d => { tapes[d.id] = d.data(); });
        renderTapes();
    });

    // --- ê¸°ëŠ¥ í•¨ìˆ˜ ---

    // [ë°œì£¼]
    window.addOrder = async () => {
        const date = document.getElementById('inputDate').value;
        const title = document.getElementById('inputTitle').value;
        const goal = parseInt(document.getElementById('inputGoal').value);
        const memo = document.getElementById('inputMemo').value;
        if (!date || !title || !goal) return alert("í•„ìˆ˜ ì •ë³´ ì…ë ¥");
        await addDoc(collection(db, "orders"), { date, title, goal, memo, done: 0 });
        document.getElementById('inputTitle').value=''; document.getElementById('inputGoal').value='';
    };
    window.deleteOrder = async (id) => { if(confirm('ì‚­ì œ?')) await deleteDoc(doc(db, "orders", id)); };
    window.updateOrder = async (id, field, val) => { 
        await updateDoc(doc(db, "orders", id), { [field]: field==='goal'?parseInt(val):val }); 
    };

    // [ì„¸íŠ¸]
    window.addWip = async () => {
        const name = document.getElementById('wipName').value.trim();
        const lot = document.getElementById('wipLot').value.trim();
        const qty = parseInt(document.getElementById('wipQty').value);
        if (!name || !lot || !qty) return alert("ì •ë³´ í™•ì¸");
        await addDoc(collection(db, "wip"), { name, lot, qty });
        document.getElementById('wipQty').value=''; document.getElementById('wipLot').value='';
    };
    window.deleteWip = async (id) => { if(confirm('ì„¸íŠ¸ ì‚­ì œ?')) await deleteDoc(doc(db, "wip", id)); };

    // [í…Œì´í”„ ìì¬]
    window.addTape = async () => {
        const type = document.getElementById('tapeTypeInput').value;
        const qty = parseInt(document.getElementById('tapeQtyInput').value);
        if(!type || !qty) return alert("ì •ë³´ í™•ì¸");

        // ê¸°ì¡´ ì¬ê³  í™•ì¸
        const tapeRef = doc(db, "tapes", type);
        const tapeSnap = await getDoc(tapeRef);
        
        let newQty = qty;
        let size = "-";
        
        // ë§¤í•‘ì—ì„œ ì‚¬ì´ì¦ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì—­ì¶”ì )
        // MAPPING ê°’ ì¤‘ tapeê°€ typeê³¼ ê°™ì€ ê²ƒ ì°¾ê¸°
        for(const k in MAPPING) {
            if(MAPPING[k].tape === type) { size = MAPPING[k].size; break; }
        }

        if (tapeSnap.exists()) {
            newQty += tapeSnap.data().qty;
        }
        
        await setDoc(tapeRef, { qty: newQty, size: size }, { merge: true });
        document.getElementById('tapeQtyInput').value = '';
        alert(`${type} í…Œì´í”„ ì…ê³  ì™„ë£Œ! (ì´ ${newQty}ì¥)`);
    };

    window.updateTape = async (id, val) => {
        await updateDoc(doc(db, "tapes", id), { qty: parseInt(val) });
    };

    // [ì‘ì—… ì •ë³´ ë¯¸ë¦¬ë³´ê¸° & ê³„ì‚°]
    window.calcWorkInfo = () => {
        const sel = document.getElementById('workProductSelect').value;
        const qtyInput = document.getElementById('workAmount').value;
        const workQty = qtyInput ? parseInt(qtyInput) : 0;
        
        const nameEl = document.getElementById('calcTapeName');
        const amtEl = document.getElementById('calcTapeAmount');
        const box = document.getElementById('predictionBox');
        
        if(!sel) { 
            nameEl.innerText="-"; amtEl.innerText="0ì¥"; box.innerText="ì„¸íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”"; 
            nameEl.dataset.tapeCode = ""; 
            nameEl.dataset.arr = 1;
            return;
        }

        const set = wip.find(x => x.id == sel);
        if(!set) return;

        // í…Œì´í”„ ì •ë³´ ì°¾ê¸°
        const key = Object.keys(MAPPING).find(k => set.name.includes(k));
        const m = key ? MAPPING[key] : {tape:"ê¸°íƒ€", arr:1, size:"-"};
        
        nameEl.innerText = `${m.tape} (ë°°ì—´: ${m.arr})`;
        nameEl.dataset.tapeCode = m.tape;
        nameEl.dataset.arr = m.arr;

        // ì†Œëª¨ëŸ‰ ê³„ì‚°
        const tapeNeeded = Math.ceil(workQty / m.arr);
        amtEl.innerText = `${tapeNeeded}ì¥`;
        
        // í˜„ì¬ ì¬ê³  í™•ì¸
        const curTapeQty = tapes[m.tape]?.qty || 0;
        if(tapeNeeded > curTapeQty) {
            amtEl.innerText += ` (ì¬ê³ ë¶€ì¡±! ë³´ìœ : ${curTapeQty})`;
            amtEl.className = "text-sm font-bold text-red-600 blink"; // ë¹¨ê°„ìƒ‰ ê°•ì¡°
        } else {
            amtEl.className = "text-sm font-bold text-blue-600";
        }

        // ë°œì£¼ ë§¤ì¹­ ë¯¸ë¦¬ë³´ê¸°
        const targets = orders.filter(o => o.title.includes(set.name) && o.done < o.goal)
                              .sort((a,b)=>new Date(a.date)-new Date(b.date));
        
        if(targets.length > 0) {
            const first = targets[0];
            box.innerText = `ìš°ì„  ${first.date} ë‚©ê¸° (${first.title})ë¡œ ë°°ë¶„ë©ë‹ˆë‹¤.`;
        } else {
            box.innerText = "ë§¤ì¹­ë˜ëŠ” ë°œì£¼ê°€ ì—†ìŠµë‹ˆë‹¤. (ì¬ê³ /ìì¬ë§Œ ì°¨ê°)";
        }
    }

    // [ì‘ì—… ì‹¤í–‰]
    window.doWork = async () => {
        const sel = document.getElementById('workProductSelect').value;
        const qty = parseInt(document.getElementById('workAmount').value);
        const tapeCode = document.getElementById('calcTapeName').dataset.tapeCode;
        const arr = parseInt(document.getElementById('calcTapeName').dataset.arr || 1);

        if(!sel || !qty) return alert("ì„¸íŠ¸ì™€ ìˆ˜ëŸ‰ì„ í™•ì¸í•˜ì„¸ìš”");
        
        const set = wip.find(x => x.id == sel);
        if(!set) return alert("ì„¸íŠ¸ ì˜¤ë¥˜");
        if(set.qty < qty) return alert(`ì„¸íŠ¸ ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë³´ìœ : ${set.qty})`);

        // í…Œì´í”„ ì¬ê³  ì²´í¬
        const tapeNeeded = Math.ceil(qty / arr);
        const curTapeQty = tapes[tapeCode]?.qty || 0;
        
        // ê²½ê³ ëŠ” ë„ìš°ì§€ë§Œ ê°•ì œ ë§‰ìŒì€ ì„ íƒ (ì¼ë‹¨ ë§‰ê¸°)
        if(tapeCode !== "ê¸°íƒ€" && curTapeQty < tapeNeeded) {
             if(!confirm(`í…Œì´í”„ ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${tapeNeeded}, ë³´ìœ : ${curTapeQty})\nê·¸ë˜ë„ ê°•ì œë¡œ ì§„í–‰í• ê¹Œìš”?`)) return;
        }

        // 1. ì„¸íŠ¸ ì°¨ê°
        const newWipQty = set.qty - qty;
        if(newWipQty === 0) await deleteDoc(doc(db, "wip", sel));
        else await updateDoc(doc(db, "wip", sel), { qty: newWipQty });

        // 2. í…Œì´í”„ ì°¨ê°
        if(tapeCode !== "ê¸°íƒ€") {
            const newTapeQty = Math.max(0, curTapeQty - tapeNeeded);
            // ë§Œì•½ ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ìƒì„±
            const tapeRef = doc(db, "tapes", tapeCode);
            await setDoc(tapeRef, { qty: newTapeQty }, { merge: true });
        }

        // 3. ë°œì£¼ ë°°ë¶„
        let remain = qty;
        const targets = orders.filter(o => o.title.includes(set.name) && o.done < o.goal)
                              .sort((a,b)=>new Date(a.date)-new Date(b.date));
        
        for (const o of targets) {
            if(remain <= 0) break;
            const fill = Math.min(remain, o.goal - o.done);
            await updateDoc(doc(db, "orders", o.id), { done: o.done + fill });
            remain -= fill;
        }

        document.getElementById('workResultMsg').innerText = `ì™„ë£Œ! ${set.name} ${qty}ê°œ ì‘ì—…, í…Œì´í”„ ${tapeNeeded}ì¥ ì°¨ê°ë¨.`;
        document.getElementById('workResultMsg').classList.remove('hidden');
        document.getElementById('workAmount').value = '';
        setTimeout(() => window.calcWorkInfo(), 500);
    }

    // --- ë Œë”ë§ í•¨ìˆ˜ ---
    function renderOrders() {
        const tbody = document.getElementById('orderListBody');
        tbody.innerHTML = '';
        const sorted = [...orders].sort((a,b)=>new Date(a.date)-new Date(b.date));
        sorted.forEach(o => {
            let pct = Math.round((o.done / o.goal) * 100);
            let bar = pct >= 100 ? 'bg-green-500' : 'bg-blue-500';
            tbody.innerHTML += `<tr>
                <td><input type="date" value="${o.date}" onchange="updateOrder('${o.id}', 'date', this.value)" class="bg-transparent text-sm w-full"></td>
                <td><div class="font-bold text-gray-800">${o.title}</div><div class="text-xs text-gray-500">${o.memo||''}</div></td>
                <td><input type="number" value="${o.goal}" onchange="updateOrder('${o.id}', 'goal', this.value)" class="w-20 text-right border rounded px-1"></td>
                <td><div class="flex justify-between text-xs mb-1"><span>${o.done.toLocaleString()}</span><span class="text-blue-600 font-bold">${pct}%</span></div><div class="progress-bar"><div class="progress-fill ${bar}" style="width:${pct>100?100:pct}%"></div></div></td>
                <td><button onclick="deleteOrder('${o.id}')" class="text-red-400 text-xs">ì‚­ì œ</button></td>
            </tr>`;
        });
    }

    function renderWip() {
        const list = document.getElementById('wipList');
        const sel = document.getElementById('workProductSelect');
        const cur = sel.value;
        
        list.innerHTML = ''; sel.innerHTML = '<option value="">(ì„¸íŠ¸ ì„ íƒ)</option>';
        wip.sort((a,b)=>a.name.localeCompare(b.name));

        if(wip.length===0) list.innerHTML = '<div class="text-gray-400 text-sm text-center">ëŒ€ê¸°ì¤‘ì¸ ì„¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';

        wip.forEach(x => {
            list.innerHTML += `<div class="bg-white border p-3 rounded shadow-sm flex justify-between items-center"><div><div class="font-bold text-gray-800">${x.name}</div><div class="text-xs text-indigo-600 font-bold">${x.lot}</div></div><div class="text-right"><div class="text-sm font-bold">${x.qty.toLocaleString()}</div><button onclick="deleteWip('${x.id}')" class="text-xs text-red-400 mt-1">ì‚­ì œ</button></div></div>`;
            sel.innerHTML += `<option value="${x.id}">${x.name} [${x.lot}] (${x.qty})</option>`;
        });
        if(wip.find(x=>x.id==cur)) sel.value=cur;
    }

    function renderTapes() {
        const tbody = document.getElementById('tapeListBody');
        tbody.innerHTML = '';
        const sortedKeys = Object.keys(tapes).sort();
        
        if(sortedKeys.length === 0) {
            tbody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-gray-400">ë“±ë¡ëœ ìì¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            return;
        }

        sortedKeys.forEach(key => {
            const t = tapes[key];
            const size = t.size || "-";
            tbody.innerHTML += `<tr>
                <td class="font-bold text-gray-700">${key}</td>
                <td class="text-xs text-gray-500">${size}</td>
                <td class="text-right"><input type="number" value="${t.qty}" onchange="updateTape('${key}', this.value)" class="w-20 text-right border rounded px-1 font-mono"></td>
                <td class="text-center"><span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">ìë™ê´€ë¦¬</span></td>
            </tr>`;
        });
    }

    // íƒ­ ì „í™˜
    const tabs = ['orderTab', 'workTab', 'tapeTab'];
    tabs.forEach(t => {
        document.getElementById('btn-'+t).addEventListener('click', ()=>{
            tabs.forEach(x => {
                document.getElementById(x).classList.add('hidden');
                document.getElementById('btn-'+x).classList.remove('active');
            });
            document.getElementById(t).classList.remove('hidden');
            document.getElementById('btn-'+t).classList.add('active');
        });
    });

    // ì´ë²¤íŠ¸ ì—°ê²°
    document.getElementById('btnAddOrder').addEventListener('click', window.addOrder);
    document.getElementById('btnAddWip').addEventListener('click', window.addWip);
    document.getElementById('btnAddTape').addEventListener('click', window.addTape);
    document.getElementById('btnDoWork').addEventListener('click', window.doWork);
    
    // ê³„ì‚°ê¸° ì—°ê²°
    document.getElementById('workProductSelect').addEventListener('change', window.calcWorkInfo);
    document.getElementById('workAmount').addEventListener('input', window.calcWorkInfo);
    
    // ì´ˆê¸°í™”
    document.getElementById('inputDate').valueAsDate = new Date();
</script>
</body>
</html>
